<!doctype html>
<html lang=en >
<head>
<title></title>
<meta charset=utf-8 >
<meta name=author content='Theo Armour' >
</head>
<body>
<script>
	var xmlHttp;
	var arrayBuffer;
	var byteArray;


	init();

	function init() {
		document.body.style.cssText = ' font: bold 12pt monospace; ';

		var info = document.body.appendChild( document.createElement( 'div' ) );
		info.innerHTML = '<h1>Read HGT Files</h1>' +
			'<div id=msg></div>';

		
		requestFile( '../J10/N37W123.hgt' );
	}

	function requestFile( fname ) {
		xmlHttp = new XMLHttpRequest();
		xmlHttp.responseType = "arraybuffer";
		xmlHttp.open( 'GET', fname, true );
		xmlHttp.send( null );
		xmlHttp.onload = callback;
	}


	function callback() {
		var canvas;
		var context;



		arrayBuffer = xmlHttp.response;
		//if (arrayBuffer) {
			byteArray = new Uint16Array( arrayBuffer );

			var min = 1000000;
			var max = 0;
//			var max_of_array = Math.max.apply(Math, byteArray);
//			var min_of_array = Math.min.apply(Math, byteArray);

			for (var i = 0; i <  1000; i++) {  // byteArray.byteLength
					max = byteArray[i] > max ? byteArray[i] : max;
					min = byteArray[i] < min ? byteArray[i] : min;
			}
			var txt = 'Length: ' + byteArray.byteLength + ' sqrt of 1/2:' + Math.sqrt( byteArray.byteLength / 2 ) + 
				' Max: ' + max + ' Min: ' + min +
			'<br>';
		//}
		msg.innerHTML = txt;
		canvas = document.body.appendChild( document.createElement( 'canvas' ) );
		canvas.width = canvas.height = 1201;
		canvas.style.cssText = 'border: 1px solid black; ';
		context = canvas.getContext( '2d' );

		var imgData = context.createImageData(1201,1201);
		var idx = 0, height;
		for ( var i = 0; i < imgData.data.length; i += 4 ) {
			height = Math.round( byteArray[ idx ] / 65535 * 5000);

			imgData.data[ i + 0 ] = height;
			imgData.data[ i + 1 ] = height;
			imgData.data[ i + 2 ] = height;
			imgData.data[ i + 3 ] = 255;
			idx++;
		}
		context.putImageData( imgData, 0, 0 );

	}

</script>
</body>
</html>